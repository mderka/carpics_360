var CarPicsSpinnerAPI=function(){return this.CarPicsSpinners=function(t){this.spinners={},this.makeBoundGetRequest=function(t,e){return function(i){0!=i.length&&(e.spinners[t.divId].spinner=new CarPicsSpinner(t,i),e.spinners[t.divId].spinStatus=!1)}},this.addSpinner=function(t,e){this.spinners[t.divId]={spinner:new CarPicsSpinner(t,e),spinStatus:!1}},this.makeSpinner=function(t){this.spinners[t.divId]={spinStatus:!1,spinner:{}},$.get(t.sourceURL,{},this.makeBoundGetRequest(t,this),"json")};for(var e=0;e<t.spinners.length;e++)this.makeSpinner(t.spinners[e])},this.CarPicsSpinner=function(t,e){if(this.divId=t.divId,this.data=e,this.numberOfConnections=t.numberOfConnections>0?t.numberOfConnections:4,this.AllLoded=!1,this.AllLoadedFunctions=[],this.turnStatus=!1,this.turning=!1,this.lastTouch=0,this.autospinSleep=t.autospinSleep>0?t.autospinSleep:100,this.mouseDisabled=t.disableMouse||!1,this.zoomed=!1,this.spinSensitivity=t.spinSensitivity>=0?t.spinSensitivity:5,this.direction=t.autospinDirection||1,"false"==t.spinOnLoad?this.spinDefault="true"==t.autospin||!1:this.spinDefault=!1,this.spinStatus=this.spinDefault,this.mouseXPosition,this.mouseYPosition,void 0!==t.overrideSize&&(t.overrideSize.width,!0)&&(t.overrideSize.height,!0)){var i=document.getElementById(t.divId);i.style.width=t.overrideSize.width,i.style.height=t.overrideSize.height}this.spinnerDiv=document.getElementById(this.divId),this.loadCyclic=function(){this.LoadCursor.Index;var t=0,e=!0;if(this.LoadCursor.Index==this.LoadCursor.NextImage.Index){if(1==this.AllImages.length)return;t=Math.floor(this.AllImages.length/2)-1,this.addImageAtCursor(t),e=!1}else for(var i=0;i<this.AllImages.length;i++){if(this.LoadCursor.NextImage.Index-this.LoadCursor.Index!=1&&this.LoadCursor.Index!=this.AllImages.length-1){t=0==this.LoadCursor.NextImage.Index?this.LoadCursor.Index+Math.floor((this.AllImages.length-this.LoadCursor.Index)/2):this.LoadCursor.Index+Math.floor((this.LoadCursor.NextImage.Index-this.LoadCursor.Index)/2),this.addImageAtCursor(t),e=!1;break}this.LoadCursor=this.LoadCursor.NextImage}return e},this.loadLinear=function(){var t=0;return!(this.LoadCursor.Index-this.LoadCursor.NextImage.Index!=1||!this.LoadCursor.NextImage)||(this.LinearReference.goLeft()?(t=0==this.LoadCursor.NextImage.Index?this.AllImages.length-1:this.LoadCursor.NextImage.Index-1,this.addImageAtCursor(t),this.LoadCursor=this.LoadCursor.PreviousImage.PreviousImage):(t=this.LoadCursor.Index+1,this.addImageAtCursor(t),this.LoadCursor=this.LoadCursor.PreviousImage),this.LoadCursor.NextImage.Index-this.LoadCursor.Index==1)},this.loadNextImage=function(){if(void 0===this.LinearReference)t=this.loadCyclic();else var t=this.loadLinear();t&&this.onAllLoaded()},this.onAllLoaded=function(){for(var t=0;t<this.AllLoadedFunctions.length;t++)"function"==typeof this.AllLoadedFunctions[t]&&this.AllLoadedFunctions[t]();this.AllLoadedFunctions={length:0,push:function(t){"function"==typeof t&&t()}}},this.addImageAtCursor=function(t){nextNext=this.LoadCursor.NextImage,this.LoadCursor.NextImage=new CarPicsImage(this.data[t],t,this.divId,this.getNextImage(this)),this.spinnerDiv.appendChild(this.LoadCursor.NextImage.HTMLElement),this.LoadCursor.PreviousImage===this.LoadCursor&&(this.LoadCursor.PreviousImage=this.LoadCursor.NextImage),nextNext.PreviousImage=this.LoadCursor.NextImage,this.AllImages[t]=this.LoadCursor.NextImage,this.LoadCursor.NextImage.PreviousImage=this.LoadCursor,this.LoadCursor.NextImage.NextImage=nextNext,this.LoadCursor=nextNext},this.getNextImage=function(t){return function(){t.loadNextImage()}},this.zoomToggle=function(t,e){return 1==this.zoomed?(this.CurrentImage.unzoom(),this.spinStatus=!1,this.zoomed=!1,!0):(this.pauseMouseTime=Date.now()+500,this.zoomed=!0,this.spinStatus=!1,this.CurrentImage.zoom(t,e),!1)},this.displayNextImage=function(t){var e,i;void 0===t?(e=this.direction,i=!0):(e=t,i=!1);var s;if(this.spinStatus||!i){if(1==e)s=this.CurrentImage.NextImage;else{if(-1!=e)return;s=this.CurrentImage.PreviousImage}for(var n=0;n<this.AllImages.length&&!s.isReady;n++)1==e?s=s.NextImage:-1==e&&(s=s.PreviousImage);if(s.isReady){var o=this.CurrentImage;this.CurrentImage=s,this.CurrentImage.HTMLElement.style.display="block",o.HTMLElement.style.display="none"}}},this.mouseDisabled||($(document).on("mousedown","#"+this.divId,function(t){return function(e){e.preventDefault();Date.now();t.zoomed||2===e.button||(t.spinStatus=!1,t.turnStatus=!0,t.mouseXPosition=e.pageX,t.mouseYPosition=e.pageY,t.spinnerDiv.style.cursor="-webkit-move",t.spinnerDiv.style.cursor="move",t.spinnerDiv.style.cursor="-moz-move")}}(this)),$(document).on("dblclick","#"+this.divId,function(t){return function(e){e.preventDefault();t.zoomToggle(e);!0===t.zoomed?(t.spinStatus=!1,t.turnStatus=!1):(t.spinStatus=t.spinDefault,t.turnStatus=!1)}}(this)),$(document).on("taphold","#"+this.divId,function(t){return function(e){if(1!=t.turning){e.preventDefault();t.zoomToggle(e,{x:t.mouseXPosition,y:t.mouseYPosition});!0===t.zoomed?(t.spinStatus=!1,t.turnStatus=!1):(t.spinStatus=t.spinDefault,t.turnStatus=!1)}}}(this)),$(document).on("mouseup",function(t){return function(e){e.preventDefault(),t.zoomed||t.mouseDisabled||(t.spinStatus=t.spinDefault,t.turnStatus=!1,t.turning=!1,t.spinnerDiv.style.cursor="-webkit-grab",t.spinnerDiv.style.cursor="grab",t.spinnerDiv.style.cursor="-moz-grab")}}(this)),$(document).on("mousemove",function(t){return function(e){if(!(t.pauseMouseTime>Date.now()||!0!==t.turnStatus&&!0!==t.zoomed)){var i=e.pageX,s=e.pageY;if(1==t.zoomed)t.CurrentImage.move(t.mouseXPosition,t.mouseYPosition);else if(t.mouseXPosition-i>t.spinSensitivity)t.turning=!0,t.displayNextImage(1);else{if(!(i-t.mouseXPosition>t.spinSensitivity))return;t.turning=!0,t.displayNextImage(-1)}t.mouseYPosition=s,t.mouseXPosition=i}}}(this)),$("#"+this.divId).bind("touchstart",function(t){return function(e){e.preventDefault(),e.returnValue=!1;Date.now();if(!t.zoomed){t.spinStatus=!1,t.turnStatus=!0;var i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.mouseXPosition=i.pageX,t.mouseYPosition=i.pageY,$("#"+t.divId).bind("touchmove",function(e){return function(i){if(i.preventDefault(),!(e.pauseMouseTime>Date.now()||!0!==e.turnStatus&&!0!==e.zoomed)){var s=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0],n=s.pageX,o=s.pageY;if(1==e.zoomed)e.CurrentImage.move(t.mouseXPosition,t.mouseYPosition);else if(e.mouseXPosition-n>e.spinSensitivity)t.turning=!0,e.displayNextImage(1);else{if(!(n-e.mouseXPosition>e.spinSensitivity))return;t.turning=!0,e.displayNextImage(-1)}e.mouseYPosition=o,e.mouseXPosition=n,e.pauseMouseTime=Date.now()+25}}}(t))}}}(this)),$(document).on("touchend","#"+this.divId,function(t){return function(e){t.mouseDisabled||(t.spinStatus=t.spinDefault,t.turnStatus=!1,t.turning=!1,t.spinnerDiv.style.cursor="-webkit-grab",t.spinnerDiv.style.cursor="grab",t.spinnerDiv.style.cursor="-moz-grab",$("#"+t.divId).unbind("touchmove",function(t){}))}}(this))),this.setDefaultSpinnerStyles=function(){this.spinnerDiv.style.cursor="grab",this.spinnerDiv.style.cursor="-webkit-grab",this.spinnerDiv.style.cursor="-moz-grab",this.spinnerDiv.style.overflow="hidden"},this.CurrentImage=new CarPicsImage(e[0],0,this.divId,function(){}),this.CurrentImage.HTMLElement.style.display="block","true"===t.linear&&(this.LinearReference={nextLeft:!1,goLeft:function(){return this.nextLeft=!this.nextLeft,this.nextLeft}}),this.AllImages=new Array(e.length),this.AllImages[0]=this.CurrentImage,this.LoadCursor=this.CurrentImage,this.mouseDisabled||this.setDefaultSpinnerStyles(),this.spinnerDiv.appendChild(this.CurrentImage.HTMLElement),this.spinStatus&&setInterval(function(t){return function(){t.spinStatus&&t.displayNextImage()}}(this),this.autospinSleep),"true"==t.spinOnLoad&&this.AllLoadedFunctions.push(function(t){return function(){t.spinStatus=1,t.spinDefault=1,setInterval(function(t){return function(){t.spinStatus&&t.displayNextImage()}}(t),t.autospinSleep)}}(this));for(var s=0;s<this.numberOfConnections;s++)this.getNextImage(this,void 0)()},this.CarPicsImage=function(t,e,i,s){var n=function(t,e){return function(){t.isReady=!0}}(this);this.zoom=function(t,e){var i=this.HTMLElement.getBoundingClientRect();this.HTMLElement.style.maxHeight="200%",this.HTMLElement.style.maxWidth="200%",this.HTMLElement.style.height="200%",this.HTMLElement.style.width="200%";var s="taphold"==t.type?e.x-window.scrollX:t.clientX,n="taphold"==t.type?e.y-window.scrollY:t.clientY,o=i.width/2-(s-i.left),r=i.height/2-(n-i.top),u=o-i.width/2,a=r-i.height/2;this.HTMLElement.style.left=u/document.documentElement.clientWidth*100+"vw",this.HTMLElement.style.top=a/document.documentElement.clientWidth*100+"vw"},this.unzoom=function(){this.HTMLElement.style.maxHeight="100%",this.HTMLElement.style.maxWidth="100%",this.HTMLElement.style.height="100%",this.HTMLElement.style.width="100%",this.HTMLElement.style.left="0px",this.HTMLElement.style.top="0px"},this.move=function(t,e){var i,s,n=this.HTMLElement.parentElement.getBoundingClientRect();t>n.left&&t<n.left+n.width&&e>n.top&&e<n.top+n.height&&(i=n.left-t,s=n.top-e,this.HTMLElement.style.left=i/document.documentElement.clientWidth*100+"vw",this.HTMLElement.style.top=s/document.documentElement.clientWidth*100+"vw")},this.setDefaultImageStyles=function(){this.HTMLElement.style.position="relative",this.HTMLElement.style.maxHeight="100%",this.HTMLElement.style.maxWidth="100%",this.HTMLElement.style.height="100%",this.HTMLElement.style.width="100%",this.HTMLElement.style.left="0vw",this.HTMLElement.style.top="0vw",this.HTMLElement.style.overflow="hidden",this.HTMLElement.style.transition="all .5s linear",this.HTMLElement.style.mozTransition="all .5s linear",this.HTMLElement.style.webkitTransition="all .5s linear",this.HTMLElement.style.oTransition="all .5s linear",this.HTMLElement.style.khtmlUserSelect="none",this.HTMLElement.style.display="none",this.HTMLElement.style.oUserSelect="none",this.HTMLElement.style.mozUserSelect="none",this.HTMLElement.style.webkitUserSelect="none",this.HTMLElement.style.userSelect="none",this.HTMLElement.ondragstart=function(){return!1}},this.NextImage=this,this.PreviousImage=this,this.Index=e,this.isReady=!1,this.sourceObject=t,this.elementId=i+"-"+t.src,this.HTMLElement=document.createElement("img"),this.setDefaultImageStyles(),this.HTMLElement.setAttribute("src",t.src),this.HTMLElement.setAttribute("id",this.elementId),this.HTMLElement.addEventListener("load",function(){s(),n()}),this.HTMLElement.addEventListener("error",s)},this}();$(document).ready(function(){for(var t=[],e=document.getElementsByClassName("carPicsSpinner"),i=0;i<e.length;i++){var s=e[i];t.push({numberOfConnections:s.getAttribute("numberOfConnections"),autospin:s.getAttribute("autospin"),autospinDirection:"left"==s.getAttribute("autospinDirection")?-1:1,spinOnLoad:s.getAttribute("spinOnLoad"),divId:s.getAttribute("id"),sourceURL:"http://api.carpics2p0.com/rest/spinner?dealer="+s.getAttribute("dealer")+"&vin="+s.getAttribute("vin"),autospinSleep:s.getAttribute("autospinSleep"),spinSensitivity:s.getAttribute("spinSensitivity"),disableMouse:s.getAttribute("disableMouse"),overrideSize:{overrideWidth:s.getAttribute("overrideWidth"),overrideHeight:s.getAttribute("overrideHeight")}})}new CarPicsSpinnerAPI.CarPicsSpinners({spinners:t})});